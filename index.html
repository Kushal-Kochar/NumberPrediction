<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Number Lookup App</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container" id="mainApp" style="display: none;">
        <div class="header-actions">
            <h1 style="margin: 0; flex: 1;">Number Lookup Application</h1>
            <button id="logoutBtn" class="logout-button-small">Logout</button>
        </div>
        
        <div class="data-status-section">
            <p id="dataStatus" class="data-status">
                <span id="dataStatusIcon">üìä</span>
                <span id="dataStatusText">Loading data...</span>
            </p>
        </div>

        <div class="input-section">
            <label for="numberInput">Enter 3-Digit Number (000-999):</label>
            <div class="input-wrapper">
                <input type="text" id="numberInput" placeholder="000" maxlength="3" pattern="[0-9]{3}" />
                <button id="searchBtn">Search</button>
            </div>
            <p class="input-hint">Enter exactly 3 digits (e.g., 001, 042, 420, 999)</p>
        </div>

        <div id="results" class="results-section">
            <!-- Results will be dynamically generated here -->
        </div>

        <div id="error" class="error-message"></div>
    </div>
    
    <div id="authRequired" class="auth-required-message">
        <div class="auth-message-card">
            <h2>Authentication Required</h2>
            <p>Please login to access the Number Lookup Application</p>
            <div class="auth-buttons">
                <a href="login.html" class="auth-button">Login</a>
                <a href="signup.html" class="auth-button-secondary">Sign Up</a>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="script.js"></script>
    <script>
        // Initialize and check authentication on page load
        (async function() {
            await initializeAdmin();
            initializeUsers();
            
            // Check authentication
            if (isLoggedIn()) {
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('authRequired').style.display = 'none';
                
                // Load Excel data from storage
                loadExcelDataFromStorage();
                
                // Handle logout
                document.getElementById('logoutBtn').addEventListener('click', function() {
                    if (confirm('Are you sure you want to logout?')) {
                        logout();
                        window.location.href = 'login.html';
                    }
                });
            } else {
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('authRequired').style.display = 'flex';
            }
        })();
        
        function loadExcelDataFromStorage() {
            const data = getExcelData();
            const timestamp = getExcelDataTimestamp();
            const statusDiv = document.getElementById('dataStatus');
            const statusText = document.getElementById('dataStatusText');
            const statusIcon = document.getElementById('dataStatusIcon');
            
            if (data && data.length > 0) {
                statusText.textContent = `Data loaded (${data.length} rows) - Last updated: ${timestamp ? new Date(timestamp).toLocaleString() : 'Unknown'}`;
                statusIcon.textContent = '‚úÖ';
                statusDiv.classList.add('success');
                statusDiv.classList.remove('error');
                
                // Set Excel data in script.js
                setTimeout(() => {
                    if (typeof window.setExcelData === 'function') {
                        window.setExcelData(data);
                    }
                }, 100);
            } else {
                statusText.textContent = 'No data available. Please ask admin to upload Excel file.';
                statusIcon.textContent = '‚ö†Ô∏è';
                statusDiv.classList.add('error');
                statusDiv.classList.remove('success');
                
                // Disable search button
                const searchBtn = document.getElementById('searchBtn');
                if (searchBtn) {
                    searchBtn.disabled = true;
                }
            }
        }
    </script>
</body>
</html>

